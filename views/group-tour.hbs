{{!-- groupTour --}}
<div class="row">
  <div class="col-md-6">
    <h1>{{groupTour.name}}</h1>
    <p>[ {{groupTour.Category.name}} ]</p>
  </div>
  <div class="col-md-6 text-end">
    {{!-- favorite button --}}
    {{#if isFavorited }}
    <form action="/favorite/{{groupTour.id}}?_method=DELETE" method="POST" style="display: contents;">
      <button type="submit" class="btn">
        <i class="fa-solid fa-heart fa-2xl" style="color: brown;"></i>
      </button>
    </form>
    {{else}}
    <form action="/favorite/{{groupTour.id}}" method="POST" style="display: contents;">
      <button type="submit" class="btn">
        <i class="fa-regular fa-heart fa-2xl" style="color: gray;"></i>
      </button>
    </form>
    {{/if}}
  </div>

  <div class="col-md-6">
    <img class="img-responsive center-block" src="{{groupTour.image}}"
      style="width: 300px; margin-bottom: 25px; transition: opacity 0.5s; opacity:0;" onload="this.style.opacity=1;">
    <br>

    <div class="well">
      <ul class="list-unstyled">
        <li><span class="badge rounded-pill bg-warning text-dark mb-2">Rating : {{groupTour.rating}}</span></li>
        <li><strong>City:</strong> {{groupTour.city}}</li>
        <li><strong>Departure Date:</strong> {{groupTour.departureDate}}</li>
        <li><strong>Return Date:</strong> {{groupTour.returnDate}}</li>
        <li><strong>Duration:</strong> {{groupTour.duration}}</li>
        <li id="inventory" value="{{groupTour.quantity}}"><strong>Quantity:</strong> {{groupTour.quantity}}</li>
        <li><strong>Price:</strong> {{groupTour.price}}</li>
        <li><strong>Can Be Cancel:</strong>{{#if groupTour.canBeCancel}} Yes{{else}} No{{/if}}</li>
      </ul>
    </div>
  </div>

  <div class="col-md-6">
    <p class="mb-5" style="white-space: break-spaces;">{{groupTour.description}}</p>
  </div>
</div>

{{!-- Order --}}
<div class="card mt-5">
  <div class="card-header bg-white text-center mt-2">
    <h3 class="my-4">Order</h3>
  </div>
  <div class="card-body">
    <form id="cartForm" action="/cart" method="POST">
      <table class="table align-middle">
        <thead>
          <tr>
            <th scope="col">Date</th>
            <th scope="col">Price</th>
            <th scope="col">Quantity</th>
            <th scope="col">Reset</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <span>{{groupTour.departureDate}}</span>
            </td>
            <td>
              <span id="groupTourPrice">{{groupTour.price}}</span>
            </td>
            <td>
              <div class="counter d-flex align-items-center">
                <button class="btn btn-sm btn-outline-secondary" style="width: 30px;"
                  onclick="decrementCount(); return false">
                  <i class="fa-solid fa-minus"></i>
                </button>
                <input type="number" class="text-center mx-2" id="count" placeholder="0" name="quantity"
                  onchange="calculateTotal()" {{#if cartItem}}value="{{cartItem.quantity}}" {{/if}} readonly required>
                <button class="btn btn-sm btn-outline-secondary" style="width: 30px;"
                  onclick="incrementCount(); return false">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
            </td>
            <td>
              <button class="btn btn-link" onclick="resetCount(); return false">
                <i class="fa-solid fa-rotate-right"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="h4 my-4">
        <div class=" row">
          <div class="col" id="total"></div>
          <div class="col text-danger text-end" id="subTotal">
          </div>
        </div>
      </div>

      <input type="hidden" name="groupTourId" value="{{groupTour.id}}">

      {{!-- cart button --}}
      <div class="text-end">
        {{#if groupTour.quantity}}
        <button type="submit" class="btn btn-primary mx-2">Add to Cart</button>
        <button type="submit" class="btn btn-warning" onclick="switchForm()">Checkout</button>
        {{else}}
        <button type="submit" class="btn btn-secondary disabled">Sold out</button>
        <a href="/group-tours" class="btn btn-primary mx-2">Continue shopping</a>
        {{/if}}
      </div>
    </form>
  </div>
</div>

<hr>

{{!-- comments --}}
<div class="row">
  {{#if groupTour.Comments}}
  <div class="col-md-12">
    <h3 class="my-4">All comments</h3>
  </div>
  {{/if}}

  {{#each groupTour.Comments}}
  <div class="col-md-12">
    {{#if ../loginUser.isAdmin}}
    <form action="/comments/{{this.id}}?_method=DELETE" method="POST" class="float-end">
      <button type="submit" class="btn btn-danger"
        onclick="return confirm(`Confirm to delete 「{{this.User.firstName}} {{this.User.lastName}}」's comment ？`)">Delete</button>
    </form>
    {{/if}}

    <h4><a href="/users/{{this.User.id}}">{{this.User.firstName}} {{this.User.lastName}}</a></h4>

    <span class="badge rounded-pill bg-secondary mb-2">Rating : {{this.rating}}</span>

    <p>{{this.text}}</p>

    <img class="img-responsive center-block" src="{{this.image}}"
      style="width: 200px; margin-bottom: 25px; transition: opacity 0.5s; opacity:0;" onload="this.style.opacity=1;">

    <footer class="blockquote-footer">{{relativeTimeFromNow this.createdAt}}</footer>
  </div>
  <hr />
  {{/each}}
</div>


{{!-- comment form --}}
<form action="/comments" method="POST" enctype="multipart/form-data">
  <div class="my-4 text-center">
    <h3 class="font-weight-normal">Please share your comments</h3>
  </div>

  <div class="form-row mb-3">
    <label class="form-label" for="rating">Rating</label>
    <input class="form-control" type="number" min="1" max="5" step="0.1" placeholder="Enter rating(1.0 ~ 5.0)"
      name="rating" id="rating" required>
  </div>

  <div class="form-row mb-3">
    <label class="form-label" for="text">Comment</label>
    <textarea class="form-control" id="text" name="text" rows="3" placeholder="Enter comment"></textarea>
  </div>
  {{!-- 把 groupTour.id 送到後端取用 --}}
  <input type="hidden" name="groupTourId" value="{{groupTour.id}}">

  <div class="form-row mb-3">
    <label class="form-label" for="image">Image</label>
    <input class="form-control" type="file" name="image" id="image">
  </div>

  <button type="submit" class="btn btn-primary">Submit</button>

  <a class="btn btn-outline-secondary" href="javascript:history.back()">Back</a>
</form>